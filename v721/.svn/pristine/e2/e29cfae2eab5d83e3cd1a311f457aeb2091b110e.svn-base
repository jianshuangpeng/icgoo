function thePrice(t){if(price=[],!allPrice)return parseFloat("0.0");jsonObj1=$.parseJSON(allPrice);var e=parseInt(jsonObj1[0].quantity),n=parseInt(jsonObj1[jsonObj1.length-1].quantity);if(e>t)price=[jsonObj1[0].price_hkhkd,jsonObj1[0].price_dlrmb,jsonObj1[0].price_hkrmb,jsonObj1[0].price_hkusd];else if(t>n)price=[jsonObj1[jsonObj1.length-1].price_hkhkd,jsonObj1[jsonObj1.length-1].price_dlrmb,jsonObj1[jsonObj1.length-1].price_hkrmb,jsonObj1[0].price_hkusd];else for(i=0;i<jsonObj1.length;i++){var r=parseInt(jsonObj1[i].quantity);t>=r&&(price=[jsonObj1[i].price_hkhkd,jsonObj1[i].price_dlrmb,jsonObj1[i].price_hkrmb,jsonObj1[i].price_hkusd])}return"$"==moneyType?price[3]:"￥"==moneyType?price[1]:void 0}function theTotal(t,e){var i=parseFloat(t)*e;return i=i.toFixed(4)}function init(){$("input[id='location_dl']").prop("checked","true"),price=thePrice(buyQty);var t="￥"+price,e="￥"+theTotal(price,buyQty);unitPrice.text(t),totalPrice.text(e),deliveryDay.text(delvery_dl)}function update_info(t,e){deliveryday="hk"==e?delvery_hk:delvery_dl,moneyType="hk"==e?"$":"￥",price=thePrice(t),the_price=moneyType+price,the_total=moneyType+theTotal(price,t),unitPrice.text(the_price),totalPrice.text(the_total),deliveryDay.text(deliveryday)}function get_other_supps(t,e,i){$.ajax({url:"/search/pricepk/",type:"GET",data:{sup:i,partno:e,qty:t},success:function(t){$("#goodprice").html(t)},error:function(){console.log("error")}})}var unitPrice=$("#unit_price"),totalPrice=$("#total_price"),deliveryDay=$("#delivery_day"),allPrice=$("input[name='all_price']").val(),buyQtyInput=$("input[name='buy_qty_d']"),buyQty=$("input[name='buy_qty_d']").val(),delvery_hk=$("input[name='delvery_hk']").val(),delvery_dl=$("input[name='delvery_dl']").val(),stockQty=$("input[name='stock_qty']").val(),minQty=$("input[name='min_qty']").val(),location_dl=$("input[id='location_dl']"),delicity=$("input[name='location']"),deliveryday=delvery_dl,downBtn=$("#buy_qty_down"),upBtn=$("#buy_qty_up"),supplier=$("input[name='supplier']").val(),partno=$("input[name='cur_partno']").val(),moneyType="￥";buyQty=parseInt(buyQty),stockQty=parseInt(stockQty),minQty=parseInt(minQty),$(function(){init(),get_other_supps(buyQty,partno,supplier),stockQty>0&&""!=allPrice&&stockQty>$.parseJSON(allPrice)[0].quantity?(buyQtyInput.change(function(){buyQty=parseInt($(this).val()),delicityVal=delicity.filter(":checked").val(),update_info(buyQty,delicityVal),$("#goodprice_qty").text(buyQty),get_other_supps(buyQty,partno,supplier)}),delicity.change(function(){update_info(buyQty,$(this).val())}),downBtn.click(function(){buyQty=parseInt(buyQtyInput.val()),delicityVal=delicity.filter(":checked").val(),update_info(buyQty,delicityVal)}),upBtn.click(function(){buyQty=parseInt(buyQtyInput.val()),delicityVal=delicity.filter(":checked").val(),update_info(buyQty,delicityVal)})):(unitPrice.text("0.0"),totalPrice.text("0.0"),buyQtyInput.attr("disabled","disabled")),$("#buy_btn").click(function(){var t=$("#server").next("ul").find("a").eq(0).attr("href");window.open(t)})});